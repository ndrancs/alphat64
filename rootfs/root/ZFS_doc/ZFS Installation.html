<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" /><title>ZFS Installation - ArchWiki</title>
<meta name="generator" content="MediaWiki 1.22.2" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="ArchWiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd" />
<link rel="copyright" href="http://www.gnu.org/copyleft/fdl.html" />
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://wiki.archlinux.org/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.archlinux&amp;only=styles&amp;skin=archlinux&amp;*" />
<!--[if IE 6]><link rel="stylesheet" href="/skins/archlinux/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/skins/archlinux/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />

<script src="https://wiki.archlinux.org/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=archlinux&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"ZFS_Installation","wgTitle":"ZFS Installation","wgCurRevisionId":302260,"wgRevisionId":302260,"wgArticleId":17033,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["File systems"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"ZFS_Installation","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"archlinux","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":
0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: archwiki:resourceloader:filter:minify-js:7:85c90aa16eaeef41f8c16fb94950cfbf */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-ZFS_Installation skin-archlinux action-view">

<div id="archnavbar"><!-- Arch Linux global navigation bar -->
	<div id="archnavbarlogo">
		<p><a id="logo" href="http://www.archlinux.org/"></a></p>
	</div>
	<div id="archnavbarmenu">
		<ul id="archnavbarlist">
			<li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki" class="anb-selected"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li>		</ul>
	</div>
</div><!-- #archnavbar -->

<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary" role="main">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">ZFS Installation</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From ArchWiki</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div style="float:right; clear:right; width:25%; margin: 0 0 0.5em 0.5em;"><p style="background:#333; color:white; padding:0.2em; border-bottom:5px #08c solid; margin:0; text-align:center; font-weight:bold;">Related articles</p><ul style="list-style-type:none; margin:0; padding:0.3em;">
<li style="padding:0.4em 0; line-height:1;"><a href="/index.php/ZFS" title="ZFS">ZFS</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="/index.php/Playing_with_ZFS" title="Playing with ZFS">Playing with ZFS</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="/index.php/Installing_Arch_Linux_on_ZFS" title="Installing Arch Linux on ZFS">Installing Arch Linux on ZFS</a></li>
<li style="padding:0.4em 0; line-height:1;"><a href="/index.php/ZFS_on_FUSE" title="ZFS on FUSE">ZFS on FUSE</a></li>
</ul></div>
<p>This article provides several options for the installation of the requisite ZFS software packages.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Building_from_AUR"><span class="tocnumber">1</span> <span class="toctext">Building from AUR</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#A_little_script_to_build_these_automatically"><span class="tocnumber">1.1</span> <span class="toctext">A little script to build these automatically</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Unofficial_Repository"><span class="tocnumber">2</span> <span class="toctext">Unofficial Repository</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Archiso_Tracking_Repository"><span class="tocnumber">2.1</span> <span class="toctext">Archiso Tracking Repository</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Building_from_AUR">Building from AUR</span></h2>
<p>The ZFS kernel module are related utils are available in the <a href="/index.php/AUR" title="AUR" class="mw-redirect">AUR</a>; all are required:
</p>
<ul>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/spl-utils/">spl-utils</a></span>
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/spl/">spl</a></span>
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs-utils/">zfs-utils</a></span>
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/zfs/">zfs</a></span>
</li>
</ul>
<div style="padding: 5px; margin: 0.50em 0; background-color: #DDDDFF; border: thin solid #BBBBDD; overflow: hidden;"><strong> Note: </strong>The ZFS and SPL (Solaris Porting Layer is a Linux kernel module which provides many of the Solaris kernel APIs) kernel modules are tied to a specific kernel version. It would not be possible to apply any kernel updates until updated packages are uploaded to AUR or the archzfs repository.</div>
<p>Should you wish to update the core/linux package before the AUR/zfs and AUR/spl packages' dependency lists are updated, a possible work-around is to remove (uninstall) spl and zfs packages (the respective modules and file system may stay in-use), update the core/linux package, build + install zfs and spl packages - just do not forget to edit PKGBUILD and correct the core/linux version number in "depends" section to match the updated version). Finally, the system may be rebooted. [ This is only for the situation, when ZFS is not used for root filesystem. ]
</p>
<h3><span class="mw-headline" id="A_little_script_to_build_these_automatically">A little script to build these automatically</span></h3>
<p>The build order of the above is important due to nested dependencies.  One can automate the entire process, including downloading the packages with the following shell script.  The only requirements for it to work are:
</p>
<ul>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=sudo">sudo</a></span> - Note that your user needed sudo rights to <code style="display:inline-block; padding: 0.1em 0.3em;">/usr/bin/clean-chroot-manager</code> for the script below to work.
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://www.archlinux.org/packages/?name=rsync">rsync</a></span> - Needed for moving over the build files.
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/cower/">cower</a></span> - Needed to grab sources from the AUR.
</li>
<li><span style="font-family: monospace"><a rel="nofollow" class="external text" href="https://aur.archlinux.org/packages/clean-chroot-manager/">clean-chroot-manager</a></span> - Needed to build in a clean chroot and add packages to a local repo.
</li>
</ul>
<p>Be sure to add the local repo to <code style="display:inline-block; padding: 0.1em 0.3em;">/etc/pacman.conf</code> like so:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ tail /etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
[chroot_local]
SigLevel = Optional TrustAll
Server = file:///path/to/localrepo/defined/below
</pre>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/bin/build_zfs</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">
#!/bin/bash
#
# ZFS Builder by graysky
#

# define the temp space for building here
WORK='/scratch'

# create this dir and chown it to your user
# this is the local repo which will store your zfs packages
REPO='/var/repo'

# Add the following entry to /etc/pacman.conf for the local repo
#[chroot_local]
#SigLevel = Optional TrustAll
#Server = file:///path/to/localrepo/defined/above

for i in rsync cower clean-chroot-manager; do
  command -v $i &gt;/dev/null 2&gt;&amp;1 || {
  echo &quot;I require $i but it's not installed. Aborting.&quot; &gt;&amp;2
  exit 1; }
done

[[ -f ~/.config/clean-chroot-manager.conf ]] &amp;&amp;
  . ~/.config/clean-chroot-manager.conf || exit 1

[[ ! -d &quot;$REPO&quot; ]] &amp;&amp;
  echo &quot;Make the dir for your local repo and chown it: $REPO&quot; &amp;&amp; exit 1

[[ ! -d &quot;$WORK&quot; ]] &amp;&amp;
  echo &quot;Make a work directory: $WORK&quot; &amp;&amp; exit 1

cd &quot;$WORK&quot;
for i in spl-utils spl zfs-utils zfs; do
  [[ -d $i ]] &amp;&amp; rm -rf $i
  cower -d $i
done

for i in spl-utils spl zfs-utils zfs; do
  cd &quot;$WORK/$i&quot;
  sudo ccm s
done

rsync -auvxP &quot;$CHROOTPATH/root/repo/&quot; &quot;$REPO&quot;
</pre>
<h2><span class="mw-headline" id="Unofficial_Repository">Unofficial Repository</span></h2>
<div style="text-align: center; margin-bottom: 1em; overflow:hidden;">
<table class="notice noprint toc" id="poorwriting" style="background: &#123;&#123;&#123;backgroundcolor}}}; border-color: &#123;&#123;&#123;bordercolor}}}; width: 100%">
<tr>
<td style="background-color: &#123;&#123;&#123;signalcolor}}}; width: 100px"> <a href="/index.php/File:Tango-mail-mark-junk.png" class="image"><img alt="Tango-mail-mark-junk.png" src="/images/e/e7/Tango-mail-mark-junk.png" width="48" height="48" /></a>
</td>
<td>  <b>This article or section is poorly written.</b> <div style="font-size: 90%"><b>Reason:</b> Does not conform with <a href="/index.php/Help:Style#Package_management_instructions" title="Help:Style">Help:Style#Package management instructions</a>. (<a rel="nofollow" class="external text" href="https://wiki.archlinux.org/index.php/Talk:ZFS_Installation">Discuss</a>)</div>
</td>
<td style="background-color: &#123;&#123;&#123;signalcolor}}}; width: 100px"> <a href="/index.php/File:Tango-mail-mark-junk.png" class="image"><img alt="Tango-mail-mark-junk.png" src="/images/e/e7/Tango-mail-mark-junk.png" width="48" height="48" /></a>
</td></tr></table>
</div>
<p>For fast and effortless installation and updates, the <a rel="nofollow" class="external text" href="https://github.com/demizer/archzfs">"archzfs"</a> signed repository is available to add to your <code style="display:inline-block; padding: 0.1em 0.3em;">pacman.conf</code>. The details of the repositories are given <a href="/index.php/Unofficial_user_repositories#demz-repo-core" title="Unofficial user repositories"> here</a>.
</p><p>Once the <a href="/index.php/Pacman-key#Adding_unofficial_keys" title="Pacman-key"> key has been signed</a>, it is now possible to update the package database and install ZFS packages:
</p>
<pre># pacman -S archzfs
</pre>
<h3><span class="mw-headline" id="Archiso_Tracking_Repository">Archiso Tracking Repository</span></h3>
<p>ZFS can easily be used from within the archiso live environment by using the special archiso tracking repository for ZFS. This repository makes it easy to install Arch Linux on a root ZFS filesystem, or to mount ZFS pools from within an archiso live environment using an up-to-date live medium. The details for using this repository from a live environment are given <a href="/index.php/Unofficial_user_repositories#demz-repo-archiso" title="Unofficial user repositories"> here</a>
</p><p>This repository and packages are also signed, so the key must be locally signed following the steps listed in the previous section before use. For a guide on how to install Arch Linux on to a root ZFS filesystem, see <a href="/index.php/Installing_Arch_Linux_on_ZFS" title="Installing Arch Linux on ZFS">Installing Arch Linux on ZFS</a>.
</p><p>When you have the above steps the process is as follows - do not use pacman -Syyu as this will require a bunch of signatures and build against a kernel that isn't running from the iso. Instead do:
</p>
<pre># pacman -Syy
</pre>
<pre># pacman -S archzfs
</pre>
<p>If this succeeded then running zfs status should give some output other than a kernel insmod error. You may then want to partition your drives using gdisk or something along those lines. If you previously partitioned your drives with zfs you're going to need to do a zfs upgrade. Make sure you have a snapshot backed up or a backup image if you have valuable data before doing this though.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.060 seconds
Real time usage: 0.073 seconds
Preprocessor visited node count: 251/1000000
Preprocessor generated node count: 940/1000000
Post‐expand include size: 5087/2097152 bytes
Template argument size: 1602/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key archwiki:pcache:idhash:17033-0!*!0!!en!2!* and timestamp 20140226223030
 -->
</div><div class="printfooter">
Retrieved from "<a href="https://wiki.archlinux.org/index.php?title=ZFS_Installation&amp;oldid=302260">https://wiki.archlinux.org/index.php?title=ZFS_Installation&amp;oldid=302260</a>"</div>
		<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/index.php/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/index.php/Category:File_systems" title="Category:File systems">File systems</a></li></ul></div></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<h2>Navigation menu</h2>
	<div id="p-cactions" class="portlet" role="navigation">
		<h3>Views</h3>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="/index.php/ZFS_Installation" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="/index.php?title=Talk:ZFS_Installation&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="/index.php?title=ZFS_Installation&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="/index.php?title=ZFS_Installation&amp;action=history" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal" role="navigation">
		<h3>Personal tools</h3>
		<div class="pBody">
			<ul>
				<li id="pt-createaccount"><a href="/index.php?title=Special:UserLogin&amp;returnto=ZFS+Installation&amp;type=signup">Create account</a></li>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=ZFS+Installation" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo" role="banner">
<a href="/index.php/Main_page" style="background-image: url(/skins/archlinux/archlogo.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation" role="navigation">
		<h3>Navigation</h3>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/index.php/Main_page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-categories"><a href="/index.php/Table_of_contents">Categories</a></li>
				<li id="n-portal"><a href="/index.php/Getting_involved" title="Various ways Archers can contribute to the community">Getting involved</a></li>
				<li id="n-currentevents"><a href="/index.php/ArchWiki:News" title="The latest lowdown on the wiki">Wiki news</a></li>
				<li id="n-recentchanges"><a href="/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/index.php/Help:Contents" title="Wiki navigation, reading, and editing help">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet" role="search">
		<h3><label for="searchInput">Search</label></h3>
		<div id="searchBody" class="pBody">
			<form action="/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" placeholder="Search" title="Search ArchWiki [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb" role="navigation">
		<h3>Tools</h3>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/index.php/Special:WhatLinksHere/ZFS_Installation" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/index.php/Special:RecentChangesLinked/ZFS_Installation" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/index.php?title=ZFS_Installation&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
				<li id="t-permalink"><a href="/index.php?title=ZFS_Installation&amp;oldid=302260" title="Permanent link to this revision of the page">Permanent link</a></li>
				<li id="t-info"><a href="/index.php?title=ZFS_Installation&amp;action=info">Page information</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer" role="contentinfo">
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 26 February 2014, at 22:30.</li>
		<li id="copyright">Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
		<li id="privacy"><a href="/index.php/ArchWiki:Privacy_policy" title="ArchWiki:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="/index.php/ArchWiki:About" title="ArchWiki:About">About ArchWiki</a></li>
		<li id="disclaimer"><a href="/index.php/ArchWiki:General_disclaimer" title="ArchWiki:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"],null,true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.046 secs. --></body><!-- Cached/compressed 20140226233641 -->
</html>